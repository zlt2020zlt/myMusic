(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{196:function(e,t,a){"use strict";a.r(t);var s=a(0),r=Object(s.a)({},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"构建和发布"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#构建和发布","aria-hidden":"true"}},[e._v("#")]),e._v(" 构建和发布")]),e._v(" "),a("h2",{attrs:{id:"构建"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#构建","aria-hidden":"true"}},[e._v("#")]),e._v(" 构建")]),e._v(" "),a("p",[e._v("当项目开发完毕，只需要运行一行命令就可以打包你的应用：")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# 打包正式环境")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("npm")]),e._v(" run build:prod\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# 打包预发布环境")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("npm")]),e._v(" run build:stage\n")])])]),a("p",[e._v("构建打包成功之后，会在根目录生成 "),a("code",[e._v("dist")]),e._v(" 文件夹，里面就是构建打包好的文件，通常是 "),a("code",[e._v("***.js")]),e._v(" 、"),a("code",[e._v("***.css")]),e._v("、"),a("code",[e._v("index.html")]),e._v(" 等静态文件。")]),e._v(" "),a("p",[e._v("如果需要自定义构建，比如指定 "),a("code",[e._v("dist")]),e._v(" 目录等，则需要通过 "),a("a",{attrs:{href:"https://github.com/PanJiaChen/vue-element-admin/blob/master/vue.config.js",target:"_blank",rel:"noopener noreferrer"}},[e._v("config"),a("OutboundLink")],1),e._v("的 "),a("code",[e._v("outputDir")]),e._v(" 进行配置。")]),e._v(" "),a("br"),e._v(" "),a("h2",{attrs:{id:"环境变量"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#环境变量","aria-hidden":"true"}},[e._v("#")]),e._v(" 环境变量")]),e._v(" "),a("p",[e._v("所有测试环境或者正式环境变量的配置都在 "),a("a",{attrs:{href:"https://github.com/PanJiaChen/vue-element-admin/blob/master/.env.development",target:"_blank",rel:"noopener noreferrer"}},[e._v(".env.development"),a("OutboundLink")],1),e._v("等 "),a("code",[e._v(".env.xxxx")]),e._v("文件中。")]),e._v(" "),a("p",[e._v("它们都会通过 "),a("code",[e._v("webpack.DefinePlugin")]),e._v(" 插件注入到全局。")]),e._v(" "),a("div",{staticClass:"tip custom-block"},[a("p",{staticClass:"custom-block-title"},[e._v("注意！！！")]),e._v(" "),a("p",[e._v("环境变量必须以"),a("code",[e._v("VUE_APP_")]),e._v("为开头。如:"),a("code",[e._v("VUE_APP_API")]),e._v("、"),a("code",[e._v("VUE_APP_TITLE")])]),e._v(" "),a("p",[e._v("你在代码中可以通过如下方式获取:")]),e._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[e._v("console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("process"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("env"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("VUE_APP_xxxx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])])]),e._v(" "),a("br"),e._v(" "),a("h2",{attrs:{id:"分析构建文件体积"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#分析构建文件体积","aria-hidden":"true"}},[e._v("#")]),e._v(" 分析构建文件体积")]),e._v(" "),a("p",[e._v("如果你的构建文件很大，你可以通过 "),a("code",[e._v("webpack-bundle-analyzer")]),e._v(" 命令构建并分析依赖模块的体积分布，从而优化你的代码。")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[e._v("npm")]),e._v(" run preview -- --report\n")])])]),a("p",[e._v("运行之后你就可以在 "),a("a",{attrs:{href:"http://localhost:9526/report.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("http://localhost:9526/report.html"),a("OutboundLink")],1),e._v(" 页面看到具体的体积分布")]),e._v(" "),a("p",[a("img",{attrs:{src:"https://wpimg.wallstcn.com/3fddf034-2b38-4299-b0d2-b748fb2abef0.jpg",alt:""}})]),e._v(" "),a("p",[e._v("具体的优化可以参考 "),a("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/26710831",target:"_blank",rel:"noopener noreferrer"}},[e._v("Webpack 大法之 Code Splitting"),a("OutboundLink")],1)]),e._v(" "),a("div",{staticClass:"tip custom-block"},[a("p",[e._v("强烈建议开启 gzip ，使用之后普遍体积只有原先 1/3 左右。打出来的 app.js 过大，查看一下是不是 Uglify 配置不正确或者 sourceMap 没弄对。 优化相关请看该 "),a("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/27710902",target:"_blank",rel:"noopener noreferrer"}},[e._v("Webpack Freestyle 之 Long Term Cache"),a("OutboundLink")],1)])]),e._v(" "),a("br"),e._v(" "),a("h2",{attrs:{id:"发布"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#发布","aria-hidden":"true"}},[e._v("#")]),e._v(" 发布")]),e._v(" "),a("p",[e._v("对于发布来讲，只需要将最终生成的静态文件，也就是通常情况下 "),a("code",[e._v("dist")]),e._v(" 文件夹的静态文件发布到你的 cdn 或者静态服务器即可，需要注意的是其中的 "),a("code",[e._v("index.html")]),e._v(" 通常会是你后台服务的入口页面，在确定了 js 和 css 的静态之后可能需要改变页面的引入路径。")]),e._v(" "),a("div",{staticClass:"tip custom-block"},[a("p",[e._v("部署时可能会发现资源路径不对 ,只需修改 "),a("code",[e._v("vue.config.js")]),e._v(" 文件资源路径即可。")])]),e._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[e._v("publicPath"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'./'")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("//请根据自己路径来配置更改")]),e._v("\n")])])]),a("h2",{attrs:{id:"前端路由与服务端的结合"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#前端路由与服务端的结合","aria-hidden":"true"}},[e._v("#")]),e._v(" 前端路由与服务端的结合")]),e._v(" "),a("p",[e._v("vue-element-admin 中，前端路由使用的是 "),a("code",[e._v("vue-router")]),e._v("，所以你可以选择两种方式："),a("code",[e._v("browserHistory")]),e._v(" 和 "),a("code",[e._v("hashHistory")]),e._v("。")]),e._v(" "),a("p",[e._v("两者的区别简单来说是对路由方式的处理不一样，"),a("code",[e._v("hashHistory")]),e._v(" 是以 "),a("code",[e._v("#")]),e._v(" 后面的路径进行处理，通过 "),a("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/API/History_API",target:"_blank",rel:"noopener noreferrer"}},[e._v("HTML 5 History"),a("OutboundLink")],1),e._v(" 进行前端路由管理，而 "),a("code",[e._v("browserHistory")]),e._v(" 则是类似我们通常的页面访问路径，并没有 "),a("code",[e._v("#")]),e._v("，但要通过服务端的配置，能够访问指定的 url 都定向到当前页面，从而能够进行前端的路由管理。")]),e._v(" "),a("p",[e._v("本项目默认使用的是 "),a("code",[e._v("hashHistory")]),e._v(" ，所以如果你的 url 里有 "),a("code",[e._v("#")]),e._v("，想去掉的话，需要切换为 "),a("code",[e._v("browserHistory")]),e._v("。\n修改 "),a("code",[e._v("src/router/index.js")]),e._v(" 中的 mode 即可")]),e._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("export")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("default")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("new")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("Router")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// mode: 'history', //后端支持可开")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n")])])]),a("p",[e._v("如果你使用的是静态站点，那么使用 "),a("code",[e._v("browserHistory")]),e._v(" 可能会无法访问你的应用，因为假设你访问 "),a("code",[e._v("http://localhost:9527/dashboard")]),e._v("，那么其实你的静态服务器并没有能够映射的文件，而使用 "),a("code",[e._v("hashHistory")]),e._v(" 则不会有这个问题，因为它的页面路径是以 "),a("code",[e._v("#")]),e._v(" 开始的，所有访问都在前端完成，如："),a("code",[e._v("http://localhost:9527/#/dashboard/")]),e._v("。")]),e._v(" "),a("p",[e._v("不过如果你有对应的后台服务器，那么我们推荐采用 "),a("code",[e._v("browserHistory")]),e._v("，只需要在服务端做一个映射，比如：")]),e._v(" "),a("p",[e._v("Apache")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v("IfModule mod_rewrite.c"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v("\n  RewriteEngine On\n  RewriteBase /\n  RewriteRule ^index\\.html$ - "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("L"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n  RewriteCond %"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("REQUEST_FILENAME"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("!")]),e._v("-f\n  RewriteCond %"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("REQUEST_FILENAME"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("!")]),e._v("-d\n  RewriteRule "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v(".")]),e._v(" /index.html "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("L"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v("/IfModule"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v("\n")])])]),a("p",[e._v("nginx")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("location / "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  try_files "),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$uri")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$uri")]),e._v("/ /index.html"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])]),a("div",{staticClass:"tip custom-block"},[a("p",[e._v("更多配置请查看 "),a("a",{attrs:{href:"https://router.vuejs.org/zh-cn/essentials/history-mode.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("vue-router 文档"),a("OutboundLink")],1)])]),e._v(" "),a("h2",{attrs:{id:"apache"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#apache","aria-hidden":"true"}},[e._v("#")]),e._v(" Apache")]),e._v(" "),a("ol",[a("li",[e._v("需要修改"),a("code",[e._v("router/index.js")]),e._v("中"),a("code",[e._v("new Router")]),e._v(" 配置，加一个"),a("code",[e._v("base: '/vue/'")]),e._v(", 它指定应用的基路径，该应用是服务于"),a("code",[e._v("localhost/vue")]),e._v("路径下，所以必须加"),a("code",[e._v("base")]),e._v("配置，否则应用会展示 404 页面")]),e._v(" "),a("li",[e._v("需要修改"),a("code",[e._v("config/index.js")]),e._v("中 build 下的"),a("code",[e._v("assetsPublicPath: '/vue/'")]),e._v("，如果用相对路径，chunk 文件会报错找不到。")]),e._v(" "),a("li",[e._v("修改"),a("code",[e._v("httpd.conf")]),e._v("文件，开启 rewrite_module 功能。")])]),e._v(" "),a("ul",[a("li",[a("code",[e._v("LoadModule rewrite_module libexec/apache2/mod_rewrite.so")]),e._v("，去掉前面的#。")]),e._v(" "),a("li",[e._v("然后找到"),a("code",[e._v("AllowOverride None")]),e._v("的那行，把它改成"),a("code",[e._v("AllowOverride All")]),e._v("，来使"),a("code",[e._v(".htaccess")]),e._v("文件生效。")])]),e._v(" "),a("ol",{attrs:{start:"4"}},[a("li",[e._v("在 apache 的"),a("code",[e._v("www/vue")]),e._v(" 目录下新建"),a("code",[e._v(".htaccess")]),e._v("文件, 需要修改"),a("code",[e._v("RewriteRule")]),e._v(" 为"),a("code",[e._v("/vue/index.html")]),e._v(", 否则刷新页面服务端会直接报 404 错误。")])]),e._v(" "),a("p",[e._v(".htaccess 文件内容")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("<IfModule mod_rewrite.c>\n  RewriteEngine On\n  RewriteBase /\n  RewriteRule ^index\\.html$ - [L]\n  RewriteCond %{REQUEST_FILENAME} !-f\n  RewriteCond %{REQUEST_FILENAME} !-d\n  RewriteRule . /vue/index.html [L]\n</IfModule>\n")])])]),a("p",[e._v("相关"),a("a",{attrs:{href:"https://github.com/PanJiaChen/vue-element-admin/issues/370",target:"_blank",rel:"noopener noreferrer"}},[e._v("issue"),a("OutboundLink")],1)])])},[],!1,null,null,null);t.default=r.exports}}]);